import pandas as pd
import random
from io import BytesIO

def generate_carryover_template(carryover_data):
    """
    Generate carryover template in required Excel format with three sheets
    """
    
    # Parse the carryover data
    lines = carryover_data.strip().split('\n')
    headers = lines[0].split('\t')
    records = []
    
    for line in lines[1:]:
        if line.strip():
            values = line.split('\t')
            records.append(dict(zip(headers, values)))
    
    # Create DataFrames for each sheet
    students = {}
    
    # Group by student and their courses
    for record in records:
        exam_no = record['EXAM NUMBER']
        name = record['NAME']
        course_code = record['COURSE CODE']
        
        if exam_no not in students:
            students[exam_no] = {
                'NAME': name,
                'courses': {}
            }
        
        # Generate random scores between 50-80 for each component
        students[exam_no]['courses'][course_code] = {
            'CA': random.randint(12, 20),  # CA typically 12-20
            'OBJ': random.randint(14, 20), # OBJ typically 14-20  
            'EXAM': random.randint(24, 40) # EXAM typically 24-40 (to sum 50-80)
        }
    
    # Get all unique course codes
    all_courses = set()
    for student_data in students.values():
        all_courses.update(student_data['courses'].keys())
    
    all_courses = sorted(list(all_courses))
    
    # Create DataFrames for each sheet
    ca_data = []
    obj_data = []
    exam_data = []
    
    for exam_no, student_data in students.items():
        ca_row = {'REG. No': exam_no, 'NAME': student_data['NAME']}
        obj_row = {'REG. No': exam_no, 'NAME': student_data['NAME']}
        exam_row = {'REG. No': exam_no, 'NAME': student_data['NAME']}
        
        for course in all_courses:
            if course in student_data['courses']:
                scores = student_data['courses'][course]
                ca_row[f'{course}_CA'] = scores['CA']
                obj_row[f'{course}_OBJ'] = scores['OBJ']
                exam_row[f'{course}_EXAM'] = scores['EXAM']
            else:
                ca_row[f'{course}_CA'] = ''
                obj_row[f'{course}_OBJ'] = ''
                exam_row[f'{course}_EXAM'] = ''
        
        ca_data.append(ca_row)
        obj_data.append(obj_row)
        exam_data.append(exam_row)
    
    # Create DataFrames
    ca_df = pd.DataFrame(ca_data)
    obj_df = pd.DataFrame(obj_data)
    exam_df = pd.DataFrame(exam_data)
    
    # Create Excel file in memory
    output = BytesIO()
    
    with pd.ExcelWriter(output, engine='xlsxwriter') as writer:
        # Write each dataframe to different sheet
        ca_df.to_excel(writer, sheet_name='CA', index=False)
        obj_df.to_excel(writer, sheet_name='OBJ', index=False)
        exam_df.to_excel(writer, sheet_name='EXAM', index=False)
        
        # Auto-adjust columns' width
        for sheet_name in ['CA', 'OBJ', 'EXAM']:
            worksheet = writer.sheets[sheet_name]
            for idx, col in enumerate(ca_df.columns):
                max_len = max(ca_df[col].astype(str).str.len().max(), len(col)) + 2
                worksheet.set_column(idx, idx, max_len)
    
    output.seek(0)
    return output

# Your carryover data
carryover_data = """EXAM NUMBER	NAME	COURSE CODE	ORIGINAL SCORE	SEMESTER	SET	RESIT ATTEMPTS	BEST SCORE	STATUS	IDENTIFIED DATE
FCTCONS/ND24/112	FOLORUNSHO AANUOLUWA PRECIOUS	EEd216	46	ND-SECOND-YEAR-SECOND-SEMESTER	ND-2024	0	46	Failed	2025-10-22 19:36:51
FCTCONS/ND24/053	NWEZE UKAMAKA MABEL	EEd216	45	ND-SECOND-YEAR-SECOND-SEMESTER	ND-2024	0	45	Failed	2025-10-22 19:36:51
FCTCONS/ND24/055	AYODELE JOHN TANTOLUWA	EEd216	49	ND-SECOND-YEAR-SECOND-SEMESTER	ND-2024	0	49	Failed	2025-10-22 19:36:51
FCTCONS/ND24/057	JIMOH PRINCESS RAHIMAT	EEd216	43	ND-SECOND-YEAR-SECOND-SEMESTER	ND-2024	0	43	Failed	2025-10-22 19:36:51
FCTCONS/ND24/007	AYO OLAMIDE PRAISE	EEd216	42	ND-SECOND-YEAR-SECOND-SEMESTER	ND-2024	0	42	Failed	2025-10-22 19:36:51
FCTCONS/ND24/097	UCHE ULOMA	NUR221	44	ND-SECOND-YEAR-SECOND-SEMESTER	ND-2024	0	44	Failed	2025-10-22 19:36:51
FCTCONS/ND24/027	BABAJI BENI DENNIS	NUR222	46	ND-SECOND-YEAR-SECOND-SEMESTER	ND-2024	0	46	Failed	2025-10-22 19:36:51
FCTCONS/ND24/018	IGBASAN PHILBERTA  OLUWASEUN	NUR222	48	ND-SECOND-YEAR-SECOND-SEMESTER	ND-2024	0	48	Failed	2025-10-22 19:36:51
FCTCONS/ND24/061	EMETA NNEOMA PHILOMENA	NUR223	41	ND-SECOND-YEAR-SECOND-SEMESTER	ND-2024	0	41	Failed	2025-10-22 19:36:51
FCTCONS/ND24/134	NUHU FAVOUR AUDU	NUR223	46	ND-SECOND-YEAR-SECOND-SEMESTER	ND-2024	0	46	Failed	2025-10-22 19:36:51
FCTCONS/ND24/120	EMMANUEL ZIPPORAH	NUR223	46	ND-SECOND-YEAR-SECOND-SEMESTER	ND-2024	0	46	Failed	2025-10-22 19:36:51
FCTCONS/ND24/128	CHIME KENECHI PAULINE	NUR224	45	ND-SECOND-YEAR-SECOND-SEMESTER	ND-2024	0	45	Failed	2025-10-22 19:36:51
FCTCONS/ND24/040	AGBEGE SUZAN	NUR224	46	ND-SECOND-YEAR-SECOND-SEMESTER	ND-2024	0	46	Failed	2025-10-22 19:36:51
FCTCONS/ND24/016	UMUNNAKWE CHISOM MICHELLE	NUR224	39	ND-SECOND-YEAR-SECOND-SEMESTER	ND-2024	0	39	Failed	2025-10-22 19:36:51
FCTCONS/ND24/075	DENEN RUTH DOOSE	NUR224	49	ND-SECOND-YEAR-SECOND-SEMESTER	ND-2024	0	49	Failed	2025-10-22 19:36:51
FCTCONS/ND24/004	ABANG STEPHANIE ADA	NUR225	37	ND-SECOND-YEAR-SECOND-SEMESTER	ND-2024	0	37	Failed	2025-10-22 19:36:51
FCTCONS/ND24/125	OKAH ANNA UDUMMA	NUR225	48	ND-SECOND-YEAR-SECOND-SEMESTER	ND-2024	0	48	Failed	2025-10-22 19:36:51
FCTCONS/ND24/003	UDEMBA DANIELLA CHINENYE	NUS221	49	ND-SECOND-YEAR-SECOND-SEMESTER	ND-2024	0	49	Failed	2025-10-22 19:36:51
FCTCONS/ND24/035	AGBOOLA OLATOMIWA	NUS221	48	ND-SECOND-YEAR-SECOND-SEMESTER	ND-2024	0	48	Failed	2025-10-22 19:36:51
FCTCONS/ND24/098	SULEIMAN MARYAM HARUNA	NUS221	40	ND-SECOND-YEAR-SECOND-SEMESTER	ND-2024	0	40	Failed	2025-10-22 19:36:51
FCTCONS/ND24/072	DAUDA HOPE AWYETU	NUS221	47	ND-SECOND-YEAR-SECOND-SEMESTER	ND-2024	0	47	Failed	2025-10-22 19:36:51
FCTCONS/ND24/086	BARNABAS RITA SIMNOM	NUS221	44	ND-SECOND-YEAR-SECOND-SEMESTER	ND-2024	0	44	Failed	2025-10-22 19:36:51
FCTCONS/ND24/006	YOHANNA DORATHY TAVINAZA	NUS222	44	ND-SECOND-YEAR-SECOND-SEMESTER	ND-2024	0	44	Failed	2025-10-22 19:36:51
FCTCONS/ND24/041	IDRIS UMMULKHAIR NDATSU	NUS222	49	ND-SECOND-YEAR-SECOND-SEMESTER	ND-2024	0	49	Failed	2025-10-22 19:36:51
FCTCONS/ND24/076	OCHOLI TREASURE EGUYE	NUS222	46	ND-SECOND-YEAR-SECOND-SEMESTER	ND-2024	0	46	Failed	2025-10-22 19:36:51
FCTCONS/ND24/019	OGAH PRINCESS UWENYI	NUR223	48	ND-SECOND-YEAR-SECOND-SEMESTER	ND-2024	0	48	Failed	2025-10-22 19:36:51
FCTCONS/ND24/019	OGAH PRINCESS UWENYI	EEd216	46	ND-SECOND-YEAR-SECOND-SEMESTER	ND-2024	0	46	Failed	2025-10-22 19:36:51
FCTCONS/ND24/066	OBADIAH MICAH	NUR223	46	ND-SECOND-YEAR-SECOND-SEMESTER	ND-2024	0	46	Failed	2025-10-22 19:36:51
FCTCONS/ND24/066	OBADIAH MICAH	EEd216	49	ND-SECOND-YEAR-SECOND-SEMESTER	ND-2024	0	49	Failed	2025-10-22 19:36:51
FCTCONS/ND24/100	BAMIDELE FAVOUR DUPE	NUR224	48	ND-SECOND-YEAR-SECOND-SEMESTER	ND-2024	0	48	Failed	2025-10-22 19:36:51
FCTCONS/ND24/100	BAMIDELE FAVOUR DUPE	EEd216	45	ND-SECOND-YEAR-SECOND-SEMESTER	ND-2024	0	45	Failed	2025-10-22 19:36:51
FCTCONS/ND24/051	NDUBUISI GIFT ONYIYECHI	NUS222	46	ND-SECOND-YEAR-SECOND-SEMESTER	ND-2024	0	46	Failed	2025-10-22 19:36:51
FCTCONS/ND24/051	NDUBUISI GIFT ONYIYECHI	EEd216	44	ND-SECOND-YEAR-SECOND-SEMESTER	ND-2024	0	44	Failed	2025-10-22 19:36:51
FCTCONS/ND24/008	OBICHEWE PAUL DAVID	NUR221	42	ND-SECOND-YEAR-SECOND-SEMESTER	ND-2024	0	42	Failed	2025-10-22 19:36:51
FCTCONS/ND24/008	OBICHEWE PAUL DAVID	NUR222	49	ND-SECOND-YEAR-SECOND-SEMESTER	ND-2024	0	49	Failed	2025-10-22 19:36:51
FCTCONS/ND24/136	JACOB OJIMA PENIEL	NUR221	40	ND-SECOND-YEAR-SECOND-SEMESTER	ND-2024	0	40	Failed	2025-10-22 19:36:51
FCTCONS/ND24/136	JACOB OJIMA PENIEL	NUR224	48	ND-SECOND-YEAR-SECOND-SEMESTER	ND-2024	0	48	Failed	2025-10-22 19:36:51
FCTCONS/ND24/103	WAKILI SHEJIYABA CONFIDENCE	NUR221	42	ND-SECOND-YEAR-SECOND-SEMESTER	ND-2024	0	42	Failed	2025-10-22 19:36:51
FCTCONS/ND24/103	WAKILI SHEJIYABA CONFIDENCE	NUR225	44	ND-SECOND-YEAR-SECOND-SEMESTER	ND-2024	0	44	Failed	2025-10-22 19:36:51
FCTCONS/ND24/137	ELIZABETH DANIEL	NUS221	48	ND-SECOND-YEAR-SECOND-SEMESTER	ND-2024	0	48	Failed	2025-10-22 19:36:51
FCTCONS/ND24/137	ELIZABETH DANIEL	NUR221	41	ND-SECOND-YEAR-SECOND-SEMESTER	ND-2024	0	41	Failed	2025-10-22 19:36:51
FCTCONS/ND24/056	MAINA SHAMMAH MUSA	NUS222	34	ND-SECOND-YEAR-SECOND-SEMESTER	ND-2024	0	34	Failed	2025-10-22 19:36:51
FCTCONS/ND24/056	MAINA SHAMMAH MUSA	NUR221	46	ND-SECOND-YEAR-SECOND-SEMESTER	ND-2024	0	46	Failed	2025-10-22 19:36:51
FCTCONS/ND24/062	ABUNIMYE FELICIA AMANUYE	NUR223	48	ND-SECOND-YEAR-SECOND-SEMESTER	ND-2024	0	48	Failed	2025-10-22 19:36:51
FCTCONS/ND24/062	ABUNIMYE FELICIA AMANUYE	NUR224	44	ND-SECOND-YEAR-SECOND-SEMESTER	ND-2024	0	44	Failed	2025-10-22 19:36:51
FCTCONS/ND24/114	YUSUF BASHIRAT ADEOLA	NUR223	49	ND-SECOND-YEAR-SECOND-SEMESTER	ND-2024	0	49	Failed	2025-10-22 19:36:51
FCTCONS/ND24/114	YUSUF BASHIRAT ADEOLA	NUR224	38	ND-SECOND-YEAR-SECOND-SEMESTER	ND-2024	0	38	Failed	2025-10-22 19:36:51
FCTCONS/ND24/014	ALU EDWINA EDUGWU	NUR223	48	ND-SECOND-YEAR-SECOND-SEMESTER	ND-2024	0	48	Failed	2025-10-22 19:36:51
FCTCONS/ND24/014	ALU EDWINA EDUGWU	NUR227	48	ND-SECOND-YEAR-SECOND-SEMESTER	ND-2024	0	48	Failed	2025-10-22 19:36:51
FCTCONS/ND24/124	IGWE GOODNESS CHINEYENWA	NUS222	30	ND-SECOND-YEAR-SECOND-SEMESTER	ND-2024	0	30	Failed	2025-10-22 19:36:51
FCTCONS/ND24/124	IGWE GOODNESS CHINEYENWA	NUR223	46	ND-SECOND-YEAR-SECOND-SEMESTER	ND-2024	0	46	Failed	2025-10-22 19:36:51
FCTCONS/ND24/102	MICHEAL CATHERINE	NUS221	46	ND-SECOND-YEAR-SECOND-SEMESTER	ND-2024	0	46	Failed	2025-10-22 19:36:51
FCTCONS/ND24/102	MICHEAL CATHERINE	NUR227	47	ND-SECOND-YEAR-SECOND-SEMESTER	ND-2024	0	47	Failed	2025-10-22 19:36:51
FCTCONS/ND24/110	ABOKO DAVID JUNIOR	NUR221	38	ND-SECOND-YEAR-SECOND-SEMESTER	ND-2024	0	38	Failed	2025-10-22 19:36:51
FCTCONS/ND24/110	ABOKO DAVID JUNIOR	NUR223	48	ND-SECOND-YEAR-SECOND-SEMESTER	ND-2024	0	48	Failed	2025-10-22 19:36:51
FCTCONS/ND24/110	ABOKO DAVID JUNIOR	NUR224	39	ND-SECOND-YEAR-SECOND-SEMESTER	ND-2024	0	39	Failed	2025-10-22 19:36:51
FCTCONS/ND24/077	OODOH COMFORT ONYENEFU	NUS221	48	ND-SECOND-YEAR-SECOND-SEMESTER	ND-2024	0	48	Failed	2025-10-22 19:36:51
FCTCONS/ND24/077	OODOH COMFORT ONYENEFU	NUR222	42	ND-SECOND-YEAR-SECOND-SEMESTER	ND-2024	0	42	Failed	2025-10-22 19:36:51
FCTCONS/ND24/077	OODOH COMFORT ONYENEFU	NUR223	48	ND-SECOND-YEAR-SECOND-SEMESTER	ND-2024	0	48	Failed	2025-10-22 19:36:51
FCTCONS/ND24/002	UMAR AMINA MAKUN	NUS221	42	ND-SECOND-YEAR-SECOND-SEMESTER	ND-2024	0	42	Failed	2025-10-22 19:36:51
FCTCONS/ND24/002	UMAR AMINA MAKUN	NUR222	49	ND-SECOND-YEAR-SECOND-SEMESTER	ND-2024	0	49	Failed	2025-10-22 19:36:51
FCTCONS/ND24/002	UMAR AMINA MAKUN	NUR223	40	ND-SECOND-YEAR-SECOND-SEMESTER	ND-2024	0	40	Failed	2025-10-22 19:36:51
FCTCONS/ND24/091	DANLADI MERCY	NUS221	41	ND-SECOND-YEAR-SECOND-SEMESTER	ND-2024	0	41	Failed	2025-10-22 19:36:51
FCTCONS/ND24/091	DANLADI MERCY	NUS222	37	ND-SECOND-YEAR-SECOND-SEMESTER	ND-2024	0	37	Failed	2025-10-22 19:36:51
FCTCONS/ND24/091	DANLADI MERCY	NUR223	41	ND-SECOND-YEAR-SECOND-SEMESTER	ND-2024	0	41	Failed	2025-10-22 19:36:51"""

# Generate the template
template_file = generate_carryover_template(carryover_data)

# Save to file with proper naming convention
filename = "CARRYOVER-SECOND-YEAR-SECOND-SEMESTER-ND-2024.xlsx"
with open(filename, 'wb') as f:
    f.write(template_file.getvalue())

print(f"Carryover template generated: {filename}")
print("File contains three sheets: CA, OBJ, EXAM")
print("Scores generated randomly between 50-80 total (CA: 12-20, OBJ: 14-20, EXAM: 24-40)")